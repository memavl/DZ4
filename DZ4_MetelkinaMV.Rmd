---
title: "DZ_4"
output: html_document
---

Выполнила Метелкина Марина

# Домашнее задание 4.

**Тема:** использование основных статистических тестов и поправок на множественные сравнения.

**Цель:** разберем использование основных параметрических и непараметрических статистических тестов, научимся вводить поправки на множественные сравнения и поймем, чем они отличаются.

```{r}
# Импорт библиотек
library(ggplot2)
library(car)
library(tidyverse)
```

### Задание 1

Рассмотрите следующую статистическую гипотезу.

Проводят некоторое исследование пациентов с артериальной гипертензией. Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

Задайте seed для воспроизводимости результатов (функция set.seed()). Задайте размер выборки sample_size \<- 30. Задайте значение среднего артериального давления до приема нового препарата и после.

```{r}
# Задаем seed
set.seed(12)

# Задаем размер выборки
sample_size <- 30

# Задаем среднее систолическое артериальное давление до и после приема нового препарата
pres_before_mean <- 140  
pres_after_mean <- 120  

# Задаем стандартное отклоненение в выборке до приема лекарств 
sd_pres_before <- 12

# Генерируем данные из нормального распределения в выборке до приема лекарств
pres_before <- rnorm(sample_size, pres_before_mean, sd_pres_before)

# Стандартное отклонение в выборке после приема лекарств
sd_pres_after <- 8

# Генерируем данные из нормального распределения в выборке после приема лекарств
pres_after <- rnorm(sample_size, pres_after_mean, sd_pres_after)

# Объедение
pressure <- data.frame(Pressure_before = pres_before,Pressure_after = pres_after)

# Проверка результата
head(pressure)
```

**Затем:**

\- Сформулируйте нулевую и альтернативную гипотезы.

\- Определите уровень значимости.

\- Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

\- Определите наблюдаемое значение статистики, а также критическое значение статистики.

\- Оцените и прокомментируйте статистическую значимость.

**Формирование гипотез:**

-H0 (нулевая гипотеза) - артериальное давление до и после приема препарата статистически значимо не отличаются

`-H1 (альтернативная гипотеза) - артериальное давление до и после приема препарата статистически значимо отличаются`

**Уровень значимости** = 0.05.

alpha = 0.05

```{r}
# Графическое отображение распределения артериального давления до приема препарата
ggplot(pressure, aes(x = Pressure_before)) +
  geom_histogram(binwidth = 5, fill = "lightblue", color = "blue") +
  labs(title = "Гистограмма распределения артериального давления до приема препарата", x = "Значения АД", y = "Частота") +
  theme_minimal()
```

**Вывод:** визуально распределение имеет признаки нормального

```{r}
# Графическое отображение распределения артериального давления после приема препарата

ggplot(pressure, aes(x = Pressure_after)) +
  geom_histogram(binwidth = 3, fill = "lightblue", color = "blue") +
  labs(title = "Гистограмма распределения артериального давления после приема препарата", x = "Значения АД", y = "Частота") +
  theme_minimal()
```

**Вывод:** распределение отлично от нормального

```{r}
# Тест Шапиро-Уилка на нормальность распределения
# H0 - распределение нормальное
# H1 - распределение отлично от нормального
# alpha = 0.05
shapiro.test(pressure$Pressure_before)
shapiro.test(pressure$Pressure_after)
```

**Вывод:** p-value = 0.7715 для Pressure_before и p-value = 0.2432 для Pressure_аfter. В обоих случаях p-value \> alpha, значит мы не можем отвергнуть нулевую гипотезу (Н0) и принимаем ее, следовательно распределение в обеих выборках нормальное и для поиска статистически значимых различий в данном случае можно применить парный t-test.

```{r}
# Определяем средние значения для каждой выборки
mean(pressure$Pressure_before)
mean(pressure$Pressure_after)

# Парный t-test
t.test(pressure$Pressure_before, pressure$Pressure_after, paired = TRUE)
```

```{r}
# Расчет критического значения для нормального распределения
alpha = 0.05
qt(1 - alpha/2, df = 29)
```

**Вывод:** По полученным результатам t-test доверительный интервал 95%. Наблюдаемое значение статистики = 8,8624 и значительно превышает критическое значение = 2.045 для 29 степеней свободы на уровне значимости 0.05.

p-value \< alpha, следовательно отвергаем Н0 и принимаем Н1 -\> есть статистически значимая разница между артериальным давлением до и после приема препарата (препарат эффективен в снижении систолического артериального давления).

### Задание 2

Рассмотрите следующую статистическую гипотезу.

Существует некоторая связь между курением и развитием рака легких. Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2

Рассмотрите два случая: для выборки sample_size1 \<- 100 и выборки sample_size2 \<- 30. Сгенерируйте данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.

**Затем:**

\- Сформулируйте нулевую и альтернативную гипотезы.

\- Определите уровень значимости.

\- Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

\- Определите наблюдаемое значение статистики, а также критическое значение статистики.

\- Оцените и прокомментируйте статистическую значимость.

```{r}
# Задаем размер первой выбороки
sample_size1 <- 100

# Создаем вектор курящих (1) и некурящих (0)
status_smok <- rep(c(1, 0), each = (sample_size1 / 2))

# Генерируем данные с заданной вероятностью для рака легких 
set.seed(13) 
canc_smok <- rbinom((sample_size1 / 2), 1, 0.8)
canc_nonsmok <- rbinom((sample_size1 / 2), 1, 0.2)

# Объединение данных
lung_canc <- c(canc_smok, canc_nonsmok)

# Создаем датафрейм
sample_1 <- data.frame(Smoking = status_smok,
                       lungsCancer = lung_canc)

# Смотрим результат
head(sample_1)
```

```{r}
# Размер второй выбороки
sample_size2 <- 30

# Создаем вектор курящих (1) и некурящих (0)
status_smok_2 <- rep(c(1, 0), each = (sample_size2 / 2))

# Генерируем данные с заданной вероятностью для рака легких
set.seed(1) 
canс_smok_2 <- rbinom((sample_size2 / 2), 1, 0.8)
canc_nonsmok_2 <- rbinom((sample_size2 / 2), 1, 0.2)

# Объединение данных
lung_canc_2 <- c(canс_smok_2, canc_nonsmok_2)

# Создаем датафрейм
sample_2 <- data.frame(Smoking = status_smok_2,
                       lungsCancer = lung_canc_2)

# Проверка
head(sample_2)
```

**Формирование гипотез:**

-H0 (нулевая гипотеза) - вероятность развития рака легких в группах курящих и некурящих одинакова.

-H1 (альтернативная гипотеза) - в группе курящих риск развития рака легких выше, чем в группе некурящих.

**Уровень значимости =** 0.05.

alpha = 0.05

```{r}
# Построение столбчатой диаграммы для первой выборки
barplot(table(sample_1$Smoking, sample_1$lungsCancer), beside = TRUE,
        col = c("lightblue", "lightgreen"), legend = c("Нет рака легких", "Рак легких"),
        names.arg = c("Некурящие", "Курящие"), main = "Рак легких среди курящих и некурящих в первой выборке",
        ylab = "Количество наблюдений")
```

```{r}
# Построение столбчатой диаграммы для второй выборки
barplot(table(sample_2$Smoking, sample_2$lungsCancer), beside = TRUE,
        col = c("lightblue", "lightgreen"), legend = c("Нет рака легких", "Рак легких"),
        names.arg = c("Некурящие", "Курящие"), main = "Рак легких среди курящих и некурящих во второй выборке",
        ylab = "Количество наблюдений")
```

**Вывод:** В обеих выборках распределение рака легких между выборками курящих и некурящих неравномерно. Наблюдения независимые между собой. Обе переменные катеориальные. Учитывая вышесказанное предпочтительнее тест Фишера.

```{r}
# Проверка гипотез на первой выборке
# Таблица сопряженности для курящих и некурящих
table100 <- table(sample_1$Smoking, sample_1$lungsCancer)

# Применение теста Фишера
# alternative = "greater" - одностороняя гипотеза, в соответствии с формулировкой альтернативной гипотезы
fisher_test_1 <- fisher.test(table100, alternative = "greater")

# Вывод результатов
fisher_test_1
```

```{r}
# Проверка гипотез на второй выборке
# Таблица сопряженности для курящих и некурящих
table30 <- table(sample_2$Smoking, sample_2$lungsCancer)

# Применение теста Фишера
# alternative = "greater" - одностороняя гипотеза, в соответствии с формулировкой альтернативной гипотезы
fisher_test_2 <- fisher.test(table30, alternative = "greater")

# Вывод результатов
fisher_test_2
```

Для первой выборки со 100 наблюдениями: p-value = 1.066e-09, 95% доверительный интервал : [6.334827 - бесконечность], Отношение шансов 15.552.

Для второй выборки с 30 наблюдениями: p-value = 0.001407, 95% доверительный интервал : [2.660628 - бесконечность], Отношение шансов 14.11256.

**Вывод:** В двух наблюдения `p-value < alpha` -\> отвергается нулевая гипотеза (Н0) и принимается альтернативная (Н1): в группе курящих риск развития рака легких статистически значимо выше, чем в группе не курящих.

### Задание 3.

Рассмотрите следующую статистическую гипотезу.

Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

Исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение.

```{r}
library("coin")

# Группа с новым методом лечения СРК
new_treatment <- rnorm(30, mean = 5, sd = 2)

# Группа руппы с диетотерапией СРК
diet <- rnorm(30, mean = 4, sd = 2)
```

**Что нужно сделать:**

-   Сформулируйте нулевую и альтернативную гипотезы.

-   Определите уровень значимости.

-   Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

-   Определите наблюдаемое значение статистики, а также критическое значение статистики.

-   Оцените и прокомментируйте статистическую значимость.

**Формирование гипотез:**

\- H0 (нулевая гипотеза): Нет различия в уровне болевых симптомов между группами

\- H1 (альтернативная гипотеза): Есть различие в уровне болевых симптомов между группами

```{r}
# Определение уровня значимости
alpha <- 0.05
```

Для проверки гипотезы используем тест Манна-Уитни ввиду непараметрической природы данных

```{r}
# тест Манна-Уитни
result <- wilcox.test(new_treatment, diet, alternative = "two.sided", exact = FALSE)

result
```

Наблюдаемое значение статистики (W): 653.

Cтатистическая значимость. P-значение: 0.002755.

Критическое значение статистики для теста Манна-Уитни не указывается напрямую в выводе теста,так как зависит от размера выборок.

P-значение меньше 0.05, что указывает на статистическую значимость различий между группами -\> нулевая гипотеза отклонена, значит новый метод лечения значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

#### Задание 4.

Рассмотрите следующую гипотезу.

Проводится исследование, в котором исследуются три противоопухолевые препарата A, B плацебо (0) на трех группах мышей. В каждой из трех групп по 10 мышей. Оценивается размер опухоли у мыши.

**Сгенерируйте датасет следующим образом:**

tumor \<- tibble(

therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),

value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))

) %\>%

mutate(therapy = factor(therapy, levels = c("0", "A", "B")))

tumor$value <- tumor$value + rnorm(30, 0, 760)

Постройте на одном графике три «ящика с усами» для наглядности.

Проведите дисперсионный анализ, чтобы выяснить, есть ли разница между размером опухоли во всех группах.

Прокомментируйте получившийся результат.

С помощью функции TukeyHSD() проведите попарные сравнения, используя критерий Тьюки.

Прокомментируйте полученные результаты.

```{r}
# Загрузка библиотек
library(tidyverse)
library(broom)

# Генерация датасета
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))

tumor$value <- tumor$value + rnorm(30, 0, 760)

# Построение на одном графике три «ящика с усами» 
ggplot(tumor, aes(x = therapy, y = value, fill = therapy)) +
  geom_boxplot() +
  labs(title = "Взаимосвязь размера опухоли от терапии", x = "Терапия", y = "Размер опухоли") +
  theme_minimal()
```

```{r}
# Визуальная оценка распределений значений в 3 выборках
tumor %>%
    ggplot(aes(value, fill = therapy)) +
    geom_density(alpha = 0.5) +
    labs(title = "Распределение размера опухоли в зависимости от выбранного вида лечения", x = "Размер опухоли", y = "Распределение") + 
    theme_bw()
```

**Вывод:** визуально распределение имеет признаки нормального

```{r}
# тест Шапиро-Уилка на опредеение нормальности распределения 
# H0 - распределение нормальное 
# H1 - распределение отлично от нормального 
# alpha = 0.05

shapiro.test(tumor$value[tumor$therapy == 0])
shapiro.test(tumor$value[tumor$therapy == 'A'])
shapiro.test(tumor$value[tumor$therapy == 'B'])
```

**Вывод:** В выборке 0, А и В p-value \> alpha, следовательно Н0 не может быть отвергнута -\> распределение в этих выборках нормально.

```{r}
# дисперсионный анализ Краскела-Уоллиса для непараметрических данных
kruskal_test = kruskal.test(value ~ therapy, data = tumor)
kruskal_test
```

**Формирование гипотез:**

-   H0 (нулевая гипотеза) - нет статистически значимых различий между размером опухоли в 3 выборках.
-   H1 (альтернативная гипотеза) - Есть статистически значимые различия между размером опухоли в 3 выборках.

**Определение уровня значимости:** alpha = 0.05

**Результат дисперсионного анализа:** p-value = 0.0003537. p-value \< alpha -\> мы не можем принять Н0 и отвергаем ее -\> принимаем H1 (альтернативная гипотеза): Есть статистически значимые различия между размером опухоли в 3 выборках.

```{r}
# Дисперсионный анализ ANNOVA
annova <- aov(value ~ therapy, data = tumor)
summary(annova)
```

```{r}
# Тест Тьюки
tukey_results <- TukeyHSD(annova, confV.level = 0.95)
print(tukey_results)
```

**Вывод по результатам теста Тьюки:**

Значения `p-adjusted` для всех сравнений:

-   Для группы A-0 - 0.2926688

-   Для группы B-0 - 0.7108625

-   Для группы В-А - 0.7428555

При сравнении групп A-0 и B-0 и В-А p-adjusted \> alpha, мы не может отвергнуть нулевую гипотезу, то есть принимаем ее, в этих группах нет статистически значимой разницы.
